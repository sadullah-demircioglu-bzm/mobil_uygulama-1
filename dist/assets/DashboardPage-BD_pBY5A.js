import{u as V,r,j as e,I as Y,a as w,c as t,n as G,o as b,p,k as v,m as g,q as _,t as H,v as q,h as z}from"./index-DScGTkQE.js";import{h as Z,E as J}from"./api-BPEy0ugj.js";import{u as Q}from"./useEffectOnce-CxcMp374.js";const ee=()=>{const h=V(),[o,f]=r.useState("duyurular"),[c,y]=r.useState(null),[u,S]=r.useState(null),[m,k]=r.useState([]),[T,I]=r.useState([]),[x,A]=r.useState([]),[L,P]=r.useState(!0),[j,E]=r.useState("");Q(()=>{let s=!0;return(async()=>{var n,i;try{const a=await Z.post(J.LOGIN,z({}));if(!s)return;y($(a.patient)),S(B(a.summary)),k(C(a.summary)),I([]),A(D(a.summary))}catch(a){if(!s)return;E(((i=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:i.message)||(a==null?void 0:a.message)||"Veriler yüklenemedi."),h.replace("/login")}finally{s&&P(!1)}})(),()=>{s=!1}});const R=s=>s?s.replace(/\D/g,"").replace(/(.{4})/g,"$1 ").trim():"",$=s=>s?{id:s.id,patient_id:s.id,ad:s.first_name,soyad:s.last_name,kartNo:R(s.card_number),telefon:s.phone_number||void 0,eposta:s.email||void 0,tcKimlik:s.tc_identity_no||void 0}:null,B=s=>{var i,a,l,d;if(!s)return null;const n=((a=(i=s.kpis)==null?void 0:i.remaining_balance)==null?void 0:a.current)??((d=(l=s.monthly_balance)==null?void 0:l[s.monthly_balance.length-1])==null?void 0:d.balance);return n==null?null:{amount:n,currency:"TRY"}},C=s=>s!=null&&s.active_discounts_details?s.active_discounts_details.map(n=>({tur:n.code||n.name,oran:n.value})):[],D=s=>{const n=(s==null?void 0:s.monthly_credit_discount_usage)||[],i=(s==null?void 0:s.monthly_balance)||[],a=new Map(i.map(l=>[l.month,l.balance]));return n.map(l=>{const d=l.credit_spent>0?"tamamlandi":"beklemede",N=Number(l.credit_added||0),M=Number(l.credit_spent||0),O=Number(l.discount_applied||0),F=M||N,K=a.get(l.month);return{id:+`${l.year}${String(l.month_number).padStart(2,"0")}`,tarih:l.label||l.month,tur:"Aylık Harcama",hastane:`Yükleme: ${N.toLocaleString("tr-TR")} ₺ | İndirim: ${O.toLocaleString("tr-TR")} ₺`,tutar:`${F.toLocaleString("tr-TR")} ₺`,durum:d,toplamTutar:K}})};return e.jsx(Y,{children:e.jsxs(w,{className:"dashboard-page",children:[L&&e.jsx("div",{style:{padding:16},children:e.jsx(t,{color:"medium",children:"Veriler yükleniyor..."})}),!!j&&e.jsx("div",{style:{padding:16},children:e.jsx(t,{color:"danger",children:j})}),e.jsxs("div",{className:"card-balance-section",children:[e.jsx("div",{className:"card-visual-full",children:e.jsxs("div",{className:"virtual-card-large",children:[e.jsx("div",{className:"card-header",children:e.jsx(t,{children:e.jsx("p",{className:"card-label",children:"BEZMİALEM VAKIF KART"})})}),e.jsxs("div",{className:"card-body",children:[e.jsx(t,{children:e.jsxs("h2",{className:"cardholder-name",children:[c==null?void 0:c.ad," ",c==null?void 0:c.soyad]})}),e.jsx(t,{color:"medium",children:e.jsx("p",{className:"card-number",children:c==null?void 0:c.kartNo})})]}),e.jsx("div",{className:"card-footer",children:e.jsx("div",{className:"card-chip"})})]})}),e.jsxs("div",{className:"balance-info-bottom",children:[e.jsxs("div",{className:"balance-card",children:[e.jsx(t,{color:"medium",children:e.jsx("p",{className:"balance-label",children:"Mevcut Bakiye"})}),e.jsx("h1",{className:"balance-amount",children:u?`${u.amount.toLocaleString("tr-TR",{style:"currency",currency:u.currency||"TRY"})}`:"-"}),e.jsxs("div",{className:"balance-status",children:[e.jsx("span",{className:"status-dot active"}),e.jsx(t,{color:"medium",children:e.jsx("span",{className:"status-text",children:"Aktif"})})]})]}),m&&m.length>0&&e.jsxs("div",{className:"indirim-section-bottom",children:[e.jsx(t,{color:"medium",children:e.jsx("p",{className:"indirim-label",children:"Tanımlı İndirimler"})}),e.jsx("div",{className:"indirim-list",children:m.map((s,n)=>e.jsxs("div",{className:"indirim-badge",children:[e.jsxs("span",{className:"indirim-oran",children:["%",s.oran]}),e.jsx("span",{className:"indirim-tur",children:s.tur})]},n))})]})]})]}),e.jsxs("div",{className:"content-tabs",children:[e.jsxs(G,{value:o,onIonChange:s=>f(s.detail.value),className:"custom-segment",children:[e.jsx(b,{value:"duyurular",children:e.jsx(p,{children:"Duyurular"})}),e.jsx(b,{value:"islemler",children:e.jsx(p,{children:"İşlemler"})})]}),e.jsxs("div",{className:"tab-content",children:[o==="duyurular"&&e.jsx("div",{className:"duyurular-list",children:T.map(s=>e.jsx(v,{className:"duyuru-card",children:e.jsxs(g,{children:[e.jsxs("div",{className:"duyuru-header",children:[e.jsx(_,{icon:H,className:"duyuru-icon"}),e.jsx(t,{color:"medium",children:e.jsx("span",{className:"duyuru-date",children:s.tarih})})]}),e.jsx("h3",{className:"duyuru-title",children:s.baslik}),e.jsx("p",{className:"duyuru-content",children:s.icerik})]})},s.id))}),o==="islemler"&&e.jsxs("div",{className:"islemler-list",children:[x.slice(0,3).map(s=>e.jsx(v,{className:"islem-card",children:e.jsxs(g,{children:[e.jsxs("div",{className:"islem-header",children:[e.jsx(_,{icon:q,className:"islem-icon"}),e.jsx("span",{className:"islem-date",children:s.tarih})]}),e.jsx("h3",{className:"islem-title",children:s.tur}),e.jsx("p",{className:"islem-location",children:s.hastane}),e.jsxs("div",{className:"islem-footer",children:[e.jsx("span",{className:"islem-amount",children:s.tutar}),e.jsx("span",{className:`islem-status ${s.durum}`,children:s.durum==="tamamlandi"?"Tamamlandı":"Beklemede"})]})]})},s.id)),x.length>=3&&e.jsx("button",{className:"see-more-button",onClick:()=>h.push("/islemler"),children:"Daha Fazlasını Göster"})]})]})]})]})})};export{ee as default};
