import{u as A,r,j as s,I as R,a as P,i as L,c as N,q as l,v as j,k as O,m as w,w as M,x as B,y as $,h as H}from"./index-DScGTkQE.js";import{h as U,E as Y}from"./api-BPEy0ugj.js";import{u as z}from"./useEffectOnce-CxcMp374.js";let t=[];const V=()=>{const c=A(),[d,i]=r.useState([]),[o,I]=r.useState(5),[y,g]=r.useState(!0),[u,C]=r.useState("");z(()=>{(async()=>{var a,e;try{const n=await U.post(Y.TRANSACTIONS_LIST,H({page:1,limit:50}),{retryMeta:{retry:1}});t=(Array.isArray(n)?n:(n==null?void 0:n.items)??[]).map(S),i(t.slice(0,o))}catch(n){C(((e=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:e.message)||(n==null?void 0:n.message)||"İşlemler yüklenemedi."),c.replace("/login")}finally{g(!1)}})()});const T=a=>{const e=Number(String(a).replace(/[^-\d.]/g,""));if(Number.isNaN(e))return String(a||"");const n=`${Math.abs(e).toLocaleString("tr-TR")} ₺`;return e<0?`- ${n}`:n},f=a=>{if(!a)return"";const e=new Date(a);return Number.isNaN(e.getTime())?"":e.toLocaleString("tr-TR")},S=a=>{var m,p,x;const e={CREDIT_ADD:"Bakiye Yükleme",CREDIT_SPEND:"Harcama",CREDIT_ROLLBACK:"İade",DISCOUNT_APPLY:"İndirim Uygulama",DISCOUNT_REBATE:"İndirim İadesi"},n=(a==null?void 0:a.status)==="RECEIVED"?"tamamlandi":"beklemede",h=((m=a==null?void 0:a.metadata)==null?void 0:m.doctor_name)||"",b=((p=a==null?void 0:a.metadata)==null?void 0:p.b2b_client_name)||((x=a==null?void 0:a.client)==null?void 0:x.name)||"",k=void 0,D=a!=null&&a.discount_amount?Number(a.discount_amount):void 0,v=(a==null?void 0:a.notes)||"";return{id:a==null?void 0:a.id,tarih:f(a==null?void 0:a.created_at),tur:e[a==null?void 0:a.type]||(a==null?void 0:a.type)||"İşlem",hastane:b,doktor:h,tutar:T(a==null?void 0:a.amount),durum:n,detay:v,indirimOrani:k,indirimTutari:D,toplamTutar:a!=null&&a.original_amount?Number(a.original_amount):void 0}},E=a=>{setTimeout(()=>{const e=o+5;I(e),i(t.slice(0,e)),a.target.complete()},500)},_=a=>{c.push(`/islemler/${a.id}`,{islem:a})};return s.jsx(R,{children:s.jsx(P,{className:"islemler-page",children:y?s.jsx("div",{className:"loading-container",children:s.jsx(L,{name:"crescent",color:"primary"})}):u?s.jsx("div",{className:"empty-state",children:s.jsx(N,{children:s.jsx("p",{className:"empty-text",children:u})})}):d.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx(l,{icon:j,className:"empty-icon"}),s.jsx(N,{children:s.jsx("p",{className:"empty-text",children:"Henüz işlem kaydınız bulunmamaktadır."})})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"islemler-list",children:d.map(a=>s.jsx(O,{className:"islem-card",button:!0,onClick:()=>_(a),children:s.jsxs(w,{children:[s.jsxs("div",{className:"islem-header",children:[s.jsxs("div",{className:"header-left",children:[s.jsx(l,{icon:j,className:"islem-icon"}),s.jsx("span",{className:"islem-date",children:a.tarih})]}),s.jsx(l,{icon:M,className:"chevron-icon"})]}),s.jsx("h3",{className:"islem-title",children:a.tur}),s.jsx("p",{className:"islem-doctor",children:a.doktor}),s.jsx("p",{className:"islem-location",children:a.hastane}),s.jsxs("div",{className:"islem-footer",children:[s.jsx("span",{className:"islem-amount",children:a.tutar}),s.jsx("span",{className:`islem-status ${a.durum}`,children:a.durum==="tamamlandi"?"Tamamlandı":"Beklemede"})]})]})},a.id))}),s.jsx(B,{threshold:"100px",disabled:o>=t.length,onIonInfinite:E,children:s.jsx($,{loadingSpinner:"crescent",loadingText:"Yükleniyor..."})})]})})})};export{V as default};
