import{r as s,u as U,j as e,I as V,a as W,c as I,d as v,i as q,k as J,m as Q,e as Y,f as z,s as O,g as ee,h as te}from"./index-DScGTkQE.js";/* empty css                */import{h as w,E as K}from"./api-BPEy0ugj.js";import{P as ae}from"./PhoneInput-wFrj9W-I.js";function E(d){const y=new Date(d),p=new Intl.DateTimeFormat("tr-TR",{timeZone:"Europe/Istanbul",day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(y),u=m=>{var g;return(g=p.find(x=>x.type===m))==null?void 0:g.value};return`${u("day")}/${u("month")}/${u("year")} ${u("hour")}:${u("minute")}`}const oe=()=>{const[d,y]=s.useState(""),[p,u]=s.useState(""),[m,g]=s.useState(""),[x,L]=s.useState("+90"),[c,C]=s.useState("tc"),[f,k]=s.useState(!1),[r,T]=s.useState(null),[X,n]=s.useState(!1),[$,i]=s.useState(""),S=U(),[j,P]=s.useState(!1),[_,A]=s.useState(!1),[N,B]=s.useState(Array(6).fill("")),F=a=>!0,M=async a=>{var o,l;if(a.preventDefault(),c==="tc"){if(!d){i("Lütfen T.C. Kimlik No giriniz."),n(!0);return}if(d.length!==11){i("T.C. Kimlik No 11 haneli olmalıdır."),n(!0);return}if(!F()){i("Geçersiz T.C. Kimlik No."),n(!0);return}}else{if(!p){i("Lütfen Pasaport No giriniz."),n(!0);return}if(p.length<6){i("Pasaport No en az 6 karakter olmalıdır."),n(!0);return}}if(!m){i("Lütfen telefon numarası giriniz."),n(!0);return}if(m.length!==10){i("Telefon numarası 10 haneli olmalıdır."),n(!0);return}if(!j){k(!0),P(!0),T(null);try{const t=`${x.replace("+","")}${m}`,b=c==="tc"?{type:"patient",tc_identity_no:d,phone_number:t}:{type:"patient",identity_no:p,phone_number:t};z(),O("");const h=await w.post(K.OTP_ATTEMPT,b),D=(h==null?void 0:h.otp_cipher)||(h==null?void 0:h.otp);if(!D)throw new Error("OTP bilgisi alınamadı.");ee({otp_cipher:D,phone_number:t,tc_identity_no:b.tc_identity_no,identity_no:b.identity_no}),A(!0),i("Doğrulama kodu gönderildi. Lütfen OTP giriniz."),n(!0)}catch(t){i(((l=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:l.message)||(t==null?void 0:t.message)||"Sorgulama sırasında bir hata oluştu."),n(!0)}finally{k(!1),P(!1)}}},R=(a,o)=>{const l=o.replace(/\D/g,"").slice(0,1),t=[...N];t[a]=l,B(t)},G=async()=>{var o,l;const a=N.join("");if(a.length!==6){i("Lütfen 6 haneli OTP giriniz."),n(!0);return}try{O(a);const t=await w.post(K.CHECK_APPLICATION,te({}));T(t)}catch(t){i(((l=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:l.message)||(t==null?void 0:t.message)||"Doğrulama başarısız."),n(!0),z(),S.replace("/login")}},H=a=>{switch(a){case"approved":return"status-approved";case"pending":return"status-pending";case"under_review":return"status-info";case"rejected":return"status-rejected";case"patient":return"status-approved";default:return"status-notfound"}},Z=a=>{switch(a){case"approved":return"Onaylandı";case"pending":return"Beklemede";case"rejected":return"Reddedildi";case"under_review":return"İnceleniyor";case"patient":return"Hasta Kabul Edildi";default:return"Bulunamadı"}};return e.jsx(V,{children:e.jsx(W,{className:"ion-padding basvuru-kontrolu-page",children:e.jsxs("div",{className:"basvuru-container",children:[e.jsx(I,{children:e.jsx("h2",{className:"page-title",children:"Başvuru Durumunu Sorgula"})}),e.jsxs("form",{onSubmit:M,className:"basvuru-form",children:[!_&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"page-description",children:"Kart başvurunuzun durumunu öğrenmek için T.C. Kimlik No veya Pasaport No ve telefon numaranızı giriniz."}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{className:"radio-option"+(c==="tc"?" active":""),children:[e.jsx("input",{type:"radio",name:"login-type",checked:c==="tc",onChange:()=>C("tc")}),"T.C. Kimlik"]}),e.jsxs("label",{className:"radio-option"+(c==="identity"?" active":""),children:[e.jsx("input",{type:"radio",name:"login-type",checked:c==="identity",onChange:()=>C("identity")}),"Diğer"]})]}),e.jsx("div",{className:"input-wrapper",children:c==="tc"?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"tc-kimlik",className:"input-label",children:"T.C. Kimlik No"}),e.jsx("input",{id:"tc-kimlik",type:"text",maxLength:11,value:d,onChange:a=>y(a.target.value.replace(/\D/g,"")),className:"custom-input",placeholder:"11 haneli kimlik numaranız",inputMode:"numeric"})]}):e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"pasaport-no",className:"input-label",children:"Pasaport No"}),e.jsx("input",{id:"pasaport-no",type:"text",value:p,onChange:a=>u(a.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"")),className:"custom-input",placeholder:"Pasaport numaranız",autoComplete:"off"})]})}),e.jsx(ae,{phoneNumber:m,countryCode:x,onPhoneChange:g,onCountryCodeChange:L,placeholder:"5XX XXX XX XX",maxLength:10,disabled:f||j}),e.jsx(v,{expand:"block",type:"submit",className:"submit-button",disabled:f||j,children:f?e.jsx(q,{name:"crescent"}):"Sorgula"})]}),_&&!r&&e.jsxs("div",{className:"otp-section",children:[e.jsx("p",{className:"page-description",children:"Cep telefonunuza gönderilen 6 haneli doğrulama kodunu giriniz."}),e.jsx("div",{className:"otp-inputs",children:N.map((a,o)=>e.jsx("input",{className:"otp-input",inputMode:"numeric",type:"text",maxLength:1,value:a,onChange:l=>R(o,l.target.value),autoComplete:"one-time-code"},o))}),e.jsx(v,{expand:"block",type:"button",className:"submit-button",disabled:f||j,onClick:G,children:"OTP ile Doğrula"})]})]}),r&&e.jsx(J,{className:"result-card",children:e.jsxs(Q,{children:[e.jsx("div",{className:`status-badge ${H(r.status)}`,children:Z(r.status)}),r.created_at&&e.jsxs("div",{className:"result-detail",children:[e.jsx("p",{className:"detail-label",children:"Başvuru Tarihi"}),e.jsx("p",{className:"detail-value",children:E(r.created_at)})]}),r.updated_at&&e.jsxs("div",{className:"result-detail",children:[e.jsx("p",{className:"detail-label",children:"Son Güncelleme"}),e.jsx("p",{className:"detail-value",children:E(r.updated_at)})]}),r.decision_notes&&e.jsx("div",{className:"result-description",children:e.jsx(I,{color:"medium",children:e.jsx("p",{children:r.decision_notes})})})]})}),e.jsx(v,{expand:"block",color:"medium",style:{borderRadius:10,height:48,marginTop:20,fontWeight:600},onClick:()=>S.push("/login"),children:"Geri Dön"}),e.jsx(Y,{isOpen:X,onDidDismiss:()=>n(!1),message:$,duration:3e3,color:"danger",position:"top"})]})})})};export{oe as default};
