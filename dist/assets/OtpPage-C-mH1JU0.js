import{u as E,r as i,j as o,I,a as N,b,c as O,d as k,e as v,l as D,s as P,h as z,g as w,f as B}from"./index-DScGTkQE.js";/* empty css                */import{h as S,E as L}from"./api-BPEy0ugj.js";const V=({onVerified:g})=>{const c=E(),[r,f]=i.useState(["","","","","",""]),[h,l]=i.useState(!1),[y,d]=i.useState(""),[u,m]=i.useState(!1);i.useEffect(()=>{const e=document.getElementById("otp-0");e==null||e.focus()},[]);const x=(e,n)=>{const t=n.replace(/\D/g,"").slice(0,1),s=[...r];if(s[e]=t,f(s),t&&e<5){const a=document.getElementById(`otp-${e+1}`);a==null||a.focus()}},j=(e,n)=>{if(n.key==="Backspace"&&!r[e]&&e>0){const t=document.getElementById(`otp-${e-1}`);t==null||t.focus()}},C=async()=>{var n,t;if(u)return;const e=r.join("");if(e.length!==6){d("Lütfen 6 haneli doğrulama kodunu giriniz."),l(!0);return}try{m(!0);const s=D();if(!s){d("OTP oturumu bulunamadı. Lütfen yeniden giriş yapınız."),l(!0),c.replace("/login");return}P(e);const a=await S.post(L.LOGIN,z({}));if(a){const p={...s};a.patient&&a.patient.id&&(p.patient_id=a.patient.id),a.patient_id&&(p.patient_id=a.patient_id),w(p)}g(),c.replace("/dashboard")}catch(s){const a=((t=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"OTP doğrulaması başarısız.";B(),d(a),l(!0),c.replace("/login")}finally{m(!1)}};return o.jsx(I,{children:o.jsx(N,{className:"ion-padding otp-page",children:o.jsxs("div",{className:"otp-container",children:[o.jsx("div",{className:"logo-container",children:o.jsx(b,{src:"/assets/logo-bezmialem.png",alt:"Bezmialem",className:"logo"})}),o.jsxs(O,{children:[o.jsx("h2",{className:"page-title",children:"Tek Seferlik Şifre"}),o.jsx("p",{className:"page-description",children:"Lütfen telefonunuza gönderilen 6 haneli doğrulama kodunu giriniz."})]}),o.jsx("div",{className:"otp-inputs",children:r.map((e,n)=>o.jsx("input",{id:`otp-${n}`,className:"otp-input",inputMode:"numeric",type:"text",maxLength:1,value:e,onChange:t=>x(n,t.target.value),onKeyDown:t=>j(n,t),autoComplete:"off"},n))}),o.jsx(k,{expand:"block",className:"verify-button",onClick:C,disabled:u,children:"Doğrula ve Devam Et"}),o.jsx(v,{isOpen:h,onDidDismiss:()=>l(!1),message:y,duration:3e3,color:"danger",position:"top"})]})})})};export{V as default};
